<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Grocery List</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    h1 { text-align: center; }
    #controls { display: flex; gap: 10px; margin-bottom: 20px; }
    #controls input { flex: 1; padding: 6px; }
    #items { margin-top: 20px; }
    .item { padding: 8px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
    .crossed { text-decoration: line-through; color: gray; }
    .amount { font-size: 0.9em; color: #555; margin-left: 8px; }
    .category-tabs { margin-bottom: 10px; }
    .category-tabs button { margin-right: 5px; padding: 5px 10px; }
    .delete-btn { background: red; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>ðŸ›’ Grocery List</h1>

  <div id="controls">
    <input type="text" id="itemInput" placeholder="Add an item..." />
    <input type="text" id="categoryInput" placeholder="Category (optional)" />
    <button onclick="addItem()">Add</button>
  </div>

  <input type="text" id="searchInput" placeholder="Search items..." oninput="renderItems()" />

  <div class="category-tabs" id="categoryTabs"></div>

  <div id="items"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwqvsrSkUKSJV6rB5GGRurZ9-npCO86iXGa9vqcvXYdamOabQ1fKC28UZZY0z3Ulpzm/exec"; // paste your Web App URL here
    let allItems = [];
    let activeCategory = "All";

    async function loadItems() {
      const res = await fetch(`${API_URL}?action=list`);
      const data = await res.json();
      if (data.status === "success") {
        allItems = data.items;
        renderCategories();
        renderItems();
      }
    }

    async function addItem() {
      const name = document.getElementById("itemInput").value.trim();
      const category = document.getElementById("categoryInput").value.trim();
      if (!name) return alert("Enter an item name!");
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({ action: "add", name, category })
      });
      document.getElementById("itemInput").value = "";
      document.getElementById("categoryInput").value = "";
      loadItems();
    }

    async function toggleItem(id) {
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({ action: "toggle", id })
      });
      loadItems();
    }

    async function editAmount(id) {
      const amount = prompt("Enter amount:");
      if (!amount) return;
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({ action: "editAmount", id, amount })
      });
      loadItems();
    }

    async function deleteItem(id) {
      if (!confirm("Delete this item?")) return;
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({ action: "delete", id })
      });
      loadItems();
    }

    function renderCategories() {
      const cats = ["All", ...new Set(allItems.map(i => i.category))];
      const container = document.getElementById("categoryTabs");
      container.innerHTML = cats.map(c => 
        `<button onclick="setCategory('${c}')">${c}</button>`
      ).join("");
    }

    function setCategory(cat) {
      activeCategory = cat;
      renderItems();
    }

    function renderItems() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      const filtered = allItems.filter(i =>
        (activeCategory === "All" || i.category === activeCategory) &&
        i.name.toLowerCase().includes(search)
      );
      document.getElementById("items").innerHTML = filtered.map(i => `
        <div class="item ${i.crossed ? 'crossed' : ''}" 
             onclick="toggleItem('${i.id}')" 
             ondblclick="editAmount('${i.id}')">
          <span>${i.name} ${i.amount ? `<span class="amount">(${i.amount})</span>` : ""}</span>
          <button class="delete-btn" onclick="event.stopPropagation(); deleteItem('${i.id}')">X</button>
        </div>
      `).join("");
    }

    loadItems();
  </script>
</body>
</html>
